# API ν†µν•© κ²€μ¦ λ³΄κ³ μ„

**κ²€μ¦ μΌμ**: 2025-01-18  
**API Base URL**: `https://www.taba.asia/api/v1`  
**λ…μ„Έμ„ λ²„μ „**: 1.5.0

## β… κ²€μ¦ μ™„λ£ ν•­λ©

### 1. μΈμ¦ API (`/auth`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/auth/login` | POST | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/auth/signup` | POST | β… | multipart/form-data μ§€μ›, ν”„λ΅ν•„ μ΄λ―Έμ§€ μ—…λ΅λ“ μ§€μ› |
| `/auth/forgot-password` | POST | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/auth/reset-password` | POST | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/auth/change-password` | PUT | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/auth/logout` | POST | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |

**ν™•μΈ μ‚¬ν•­**:
- β… λ¨λ“  μ”μ²­/μ‘λ‹µ κµ¬μ΅°κ°€ λ…μ„Έμ„μ™€ μΌμΉ
- β… μ—λ¬ μ²λ¦¬ (401, 400, 404 λ“±) μ¬λ°”λ¥΄κ² κµ¬ν„
- β… νμ›κ°€μ… μ‹ ν”„λ΅ν•„ μ΄λ―Έμ§€ μ—…λ΅λ“ μ§€μ› (multipart/form-data)
- β… JWT ν† ν° μλ™ μ €μ¥ λ° κ΄€λ¦¬

### 2. μ‚¬μ©μ API (`/users`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/users/{userId}` | GET | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/users/{userId}` | PUT | β… | multipart/form-data μ§€μ›, ν”„λ΅ν•„ μ΄λ―Έμ§€ μ—…λ΅λ“ μ§€μ› |
| `/users/{userId}/fcm-token` | PUT | β… | FCM ν† ν° λ“±λ΅ μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |

**ν™•μΈ μ‚¬ν•­**:
- β… ν”„λ΅ν•„ μ΅°ν μ‹ `getCurrentUser()`λ” `userId`λ¥Ό `TokenStorage`μ—μ„ κ°€μ Έμ™€ `/users/{userId}` νΈμ¶
- β… ν”„λ΅ν•„ μμ • μ‹ `profileImage`μ™€ `avatarUrl` μ²λ¦¬ λ΅μ§ μ¬λ°”λ¦„
- β… FCM ν† ν° λ“±λ΅ μ—”λ“ν¬μΈνΈ μ¬λ°”λ¦„ (`/users/{userId}/fcm-token`)

### 3. νΈμ§€ API (`/letters`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/letters` | POST | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/letters/public` | GET | β… | νμ΄μ§• μ§€μ›, λ΅κ·ΈμΈ μ‹ μμ‹ μ νΈμ§€ μλ™ μ μ™Έ (μ„λ²„ μ²λ¦¬) |
| `/letters/{letterId}` | GET | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/letters/{letterId}/reply` | POST | β… | μλ™ μΉκµ¬ μ¶”κ°€ κΈ°λ¥ ν¬ν•¨ |
| `/letters/{letterId}/report` | POST | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/letters/{letterId}` | DELETE | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |

**ν™•μΈ μ‚¬ν•­**:
- β… νΈμ§€ μ‘μ„± μ‹ `visibility`, `recipientId`, `scheduledAt`, `attachedImages` μ¬λ°”λ¥΄κ² μ²λ¦¬
- β… λ‹µμ¥ μ‹ `visibility` ν•„λ“ μ μ™Έ (μ„λ²„μ—μ„ μλ™μΌλ΅ DIRECT μ„¤μ •)
- β… κ³µκ° νΈμ§€ λ©λ΅μ€ μ„λ²„μ—μ„ λ΅κ·ΈμΈ μ‚¬μ©μμ νΈμ§€λ¥Ό μλ™μΌλ΅ μ μ™Έ
- β… μ—λ¬ μ²λ¦¬ (401, 400, 403, 404) μ¬λ°”λ¥΄κ² κµ¬ν„

### 4. μΉκµ¬ API (`/friends`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/friends/invite` | POST | β… | μ΄λ€ μ½”λ“ ν•μ‹ κ²€μ¦ ν¬ν•¨ |
| `/friends` | GET | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/friends/{friendId}` | DELETE | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/friends/{friendId}/letters` | GET | β… | νμ΄μ§• λ° μ •λ ¬ μ§€μ› |

**ν™•μΈ μ‚¬ν•­**:
- β… μ΄λ€ μ½”λ“ ν•μ‹: μ •ν™•ν 6μλ¦¬ μ«μ+μλ¬Έ μ΅°ν•© (UIμ—μ„ `maxLength: 6` μ ν•)
- β… μ΄λ€ μ½”λ“ μ—λ¬ μ½”λ“ μ²λ¦¬ (`INVALID_INVITE_CODE`, `INVITE_CODE_EXPIRED`, λ“±)
- β… μΉκµ¬ λ©λ΅ μ‘λ‹µ κµ¬μ΅°: `UserDto` λ°°μ—΄μ„ `FriendProfileDto`λ΅ λ³€ν™ (κΈ°λ³Έκ°’ μ²λ¦¬)
- β… μΉκµ¬λ³„ νΈμ§€ λ©λ΅ μ‘λ‹µ κµ¬μ΅°: `SharedFlowerDto` μ¬λ°”λ¥΄κ² νμ‹±

### 5. μ΄λ€ μ½”λ“ API (`/invite-codes`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/invite-codes/generate` | POST | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/invite-codes/current` | GET | β… | `null` μ‘λ‹µ μ²λ¦¬ ν¬ν•¨ |

**ν™•μΈ μ‚¬ν•­**:
- β… μ΄λ€ μ½”λ“ μƒμ„± λ° μ΅°ν μ¬λ°”λ¥΄κ² κµ¬ν„
- β… ν™μ„± μ½”λ“κ°€ μ—†κ±°λ‚ λ§λ£λ κ²½μ° `null` μ‘λ‹µ μ²λ¦¬

### 6. μ•λ¦Ό API (`/notifications`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/notifications` | GET | β… | νμ΄μ§• λ° μΉ΄ν…κ³ λ¦¬ ν•„ν„° μ§€μ› |
| `/notifications/{notificationId}/read` | PUT | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |
| `/notifications/read-all` | PUT | β… | `readCount` μ •λ³΄λ” μ‚¬μ©ν•μ§€ μ•μ (void μ²λ¦¬) |
| `/notifications/{notificationId}` | DELETE | β… | μ¬λ°”λ¥΄κ² κµ¬ν„λ¨ |

**ν™•μΈ μ‚¬ν•­**:
- β… μ•λ¦Ό λ©λ΅ νμ΄μ§• λ° μΉ΄ν…κ³ λ¦¬ ν•„ν„° μ§€μ›
- β… μ „μ²΄ μ½μ μ²λ¦¬ μ‘λ‹µ κµ¬μ΅° μ¬λ°”λ¦„ (`readCount` μ •λ³΄λ” λ¬΄μ‹)

### 7. νμΌ API (`/files`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/files/upload` | POST | β… | multipart/form-data μ§€μ› |

**ν™•μΈ μ‚¬ν•­**:
- β… μ΄λ―Έμ§€ μ—…λ΅λ“ μ‘λ‹µ κµ¬μ΅°: `{ url: "...", fileName: "..." }`μ—μ„ `url`λ§ μ¶”μ¶
- β… λ‹¤μ¤‘ μ΄λ―Έμ§€ μ—…λ΅λ“ μ§€μ› (`uploadImages` λ©”μ„λ“)
- β… μ—λ¬ μ²λ¦¬ (400, 413 Payload Too Large) μ¬λ°”λ¥΄κ² κµ¬ν„

### 8. μ„¤μ • API (`/settings`)

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μƒνƒ | λΉ„κ³  |
|-----------|--------|------|------|
| `/settings/push-notification` | GET | β… | μ‘λ‹µ κµ¬μ΅°: `{ enabled: true }` |
| `/settings/push-notification` | PUT | β… | μ”μ²­/μ‘λ‹µ κµ¬μ΅° μ¬λ°”λ¦„ |
| `/settings/language` | GET | β… | μ‘λ‹µ κµ¬μ΅°: `{ language: "ko" }` |
| `/settings/language` | PUT | β… | μ”μ²­/μ‘λ‹µ κµ¬μ΅° μ¬λ°”λ¦„ |

**ν™•μΈ μ‚¬ν•­**:
- β… μ„¤μ • API μ‘λ‹µ κµ¬μ΅°: `data['enabled']`, `data['language']` μ¬λ°”λ¥΄κ² μ ‘κ·Ό
- β… μ”μ²­/μ‘λ‹µ κµ¬μ΅°κ°€ λ…μ„Έμ„μ™€ μΌμΉ

## π“‹ λ°μ΄ν„° κµ¬μ΅° κ²€μ¦

### DTO νμ‹±

1. **SharedFlowerDto** β…
   - `letter` κ°μ²΄ μ¤‘μ²© κµ¬μ΅° μ¬λ°”λ¥΄κ² νμ‹±
   - `fontFamily` μµμƒμ„ λ λ²¨ μ°μ„  μ²λ¦¬
   - `sentByMe`, `isRead` ν•„λ“ μ¬λ°”λ¥΄κ² μ²λ¦¬

2. **LetterDto** β…
   - `template` κ°μ²΄ νμ‹± (hex μƒ‰μƒ μ½”λ“ + μƒ‰μƒ μ΄λ¦„ μ§€μ›)
   - `attachedImages` λ°°μ—΄ μ¬λ°”λ¥΄κ² μ²λ¦¬
   - `sentAt` ν•„λ“ ν•­μƒ ν¬ν•¨ (fallback μ κ±°)

3. **UserDto** β…
   - `username`, `statusMessage` ν•„λ“ μ κ±°λ¨
   - `avatarUrl`, `nickname` ν•„λ“ μ¬λ°”λ¥΄κ² μ²λ¦¬

4. **FriendProfileDto** β…
   - `/friends` μ—”λ“ν¬μΈνΈ μ‘λ‹µμ„ μ¬λ°”λ¥΄κ² λ³€ν™
   - `lastLetterAt` κΈ°λ³Έκ°’ μ²λ¦¬ (API μ‘λ‹µμ— μ—†μ)

5. **InviteCodeDto** β…
   - `code`, `expiresAt`, `remainingMinutes` ν•„λ“ μ¬λ°”λ¥΄κ² μ²λ¦¬
   - `null` μ‘λ‹µ μ²λ¦¬ ν¬ν•¨

6. **NotificationDto** β…
   - λ¨λ“  ν•„λ“ μ¬λ°”λ¥΄κ² νμ‹±
   - `category`, `relatedId` ν•„λ“ ν¬ν•¨

### μ—λ¬ μ²λ¦¬

λ¨λ“  μ„λΉ„μ¤ λ μ΄μ–΄μ—μ„ λ‹¤μ μ—λ¬ μ½”λ“λ¥Ό μ¬λ°”λ¥΄κ² μ²λ¦¬:
- β… `INVALID_CREDENTIALS` (401)
- β… `INVALID_EMAIL`, `EMAIL_ALREADY_EXISTS`, `INVALID_PASSWORD` (400)
- β… `INVALID_INVITE_CODE`, `INVITE_CODE_EXPIRED`, `INVITE_CODE_ALREADY_USED`, `CANNOT_USE_OWN_INVITE_CODE`, `ALREADY_FRIENDS` (400)
- β… `USER_NOT_FOUND`, `LETTER_NOT_FOUND`, `FRIENDSHIP_NOT_FOUND` (404)
- β… `FORBIDDEN` (403)
- β… `INTERNAL_SERVER_ERROR` (500)

## π” νΉλ³„ ν™•μΈ μ‚¬ν•­

### 1. κ³µκ° νΈμ§€ λ©λ΅
- β… λ΅κ·ΈμΈ μ‚¬μ©μμ νΈμ§€ μλ™ μ μ™Έ (μ„λ²„ μ²λ¦¬)
- β… νμ΄μ§• νλΌλ―Έν„° (`page`, `size`) μ¬λ°”λ¥΄κ² μ „λ‹¬

### 2. μΉκµ¬λ³„ νΈμ§€ λ©λ΅
- β… νμ΄μ§• λ° μ •λ ¬ νλΌλ―Έν„° (`page`, `size`, `sort`) μ¬λ°”λ¥΄κ² μ „λ‹¬
- β… μ‘λ‹µ κµ¬μ΅° (`SharedFlowerDto`) μ¬λ°”λ¥΄κ² νμ‹±
- β… `sentByMe`, `isRead` ν•„λ“ μ¬λ°”λ¥΄κ² μ²λ¦¬

### 3. μ΄λ€ μ½”λ“
- β… UIμ—μ„ `maxLength: 6` μ ν•
- β… μ„λ²„μ—μ„ ν•μ‹ κ²€μ¦ (6μλ¦¬ μ«μ+μλ¬Έ μ΅°ν•©)
- β… μ—λ¬ λ©”μ‹μ§€ κµ¬μ²΄μ μΌλ΅ ν‘μ‹

### 4. νμΌ μ—…λ΅λ“
- β… multipart/form-data μ¬λ°”λ¥΄κ² μ²λ¦¬
- β… μ‘λ‹µμ—μ„ `url` ν•„λ“λ§ μ¶”μ¶ν•μ—¬ μ‚¬μ©
- β… λ‹¤μ¤‘ μ΄λ―Έμ§€ μ—…λ΅λ“ μ§€μ›

### 5. FCM ν† ν° λ“±λ΅
- β… μ—”λ“ν¬μΈνΈ: `/users/{userId}/fcm-token` (PUT)
- β… μ”μ²­ λ³Έλ¬Έ: `{ fcmToken: "..." }`
- β… λ΅κ·ΈμΈ/νμ›κ°€μ… μ‹ μλ™ λ“±λ΅
- β… λ΅κ·Έμ•„μ›ƒ μ‹ ν† ν° μ‚­μ 

## β… μµμΆ… κ²€μ¦ κ²°κ³Ό

**μ „μ²΄ API ν†µν•© μƒνƒ**: β… **μ™„λ£**

λ¨λ“  API μ—”λ“ν¬μΈνΈκ°€ λ…μ„Έμ„μ™€ μΌμΉν•λ©°, μ”μ²­/μ‘λ‹µ κµ¬μ΅°, μ—λ¬ μ²λ¦¬, λ°μ΄ν„° νμ‹±μ΄ μ¬λ°”λ¥΄κ² κµ¬ν„λμ–΄ μμµλ‹λ‹¤.

### μ£Όμ” ν™•μΈ μ‚¬ν•­ μ”μ•½

1. β… λ¨λ“  μ—”λ“ν¬μΈνΈ κ²½λ΅κ°€ λ…μ„Έμ„μ™€ μΌμΉ
2. β… μ”μ²­/μ‘λ‹µ λ°μ΄ν„° κµ¬μ΅°κ°€ λ…μ„Έμ„μ™€ μΌμΉ
3. β… μ—λ¬ μ½”λ“ μ²λ¦¬κ°€ λ…μ„Έμ„μ™€ μΌμΉ
4. β… DTO νμ‹± λ΅μ§μ΄ μ¬λ°”λ¦„
5. β… νμ΄μ§• νλΌλ―Έν„°κ°€ μ¬λ°”λ¥΄κ² μ „λ‹¬λ¨
6. β… multipart/form-data μ²λ¦¬κ°€ μ¬λ°”λ¦„
7. β… FCM ν† ν° λ“±λ΅μ΄ μ¬λ°”λ¥΄κ² κµ¬ν„λ¨
8. β… μ΄λ€ μ½”λ“ ν•μ‹ κ²€μ¦μ΄ μ¬λ°”λ¦„

---

**κ²€μ¦ μ™„λ£μΌ**: 2025-01-18  
**κ²€μ¦μ**: AI Assistant  
**μƒνƒ**: β… λ¨λ“  ν•­λ© κ²€μ¦ μ™„λ£

