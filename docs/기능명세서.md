# Taba 기능명세서

## API 기본 정보

### Base URL
- **개발 서버**: `http://cobyserver.iptime.org:8080`
- **API 버전**: `v1`
- **전체 Base URL**: `http://cobyserver.iptime.org:8080/api/v1`

### 인증 방식
- **방식**: JWT Bearer Token
- **헤더**: `Authorization: Bearer {token}`
- **토큰 저장**: SharedPreferences (클라이언트)
- **토큰 만료**: 401 응답 시 자동 로그아웃 처리

### 공통 응답 구조

#### 성공 응답
```json
{
  "success": true,
  "data": { ... },
  "message": "string" (optional)
}
```

#### 에러 응답
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "에러 메시지",
    "details": {} (optional)
  }
}
```

### 페이징 응답 구조
```json
{
  "success": true,
  "data": {
    "content": [...],
    "page": 0,
    "number": 0,
    "size": 20,
    "totalElements": 100,
    "totalPages": 5,
    "first": true,
    "last": false,
    "pageable": {
      "pageNumber": 0,
      "pageSize": 20,
      "offset": 0,
      "paged": true,
      "unpaged": false,
      "sort": {
        "sorted": true,
        "empty": false,
        "unsorted": false
      }
    }
  }
}
```

### 에러 코드
- **400**: Bad Request (잘못된 요청)
- **401**: Unauthorized (인증 실패)
- **403**: Forbidden (권한 없음)
- **404**: Not Found (리소스 없음)
- **500**: Internal Server Error (서버 오류)

---

## 1. 인증 (Authentication)

### 1.1 회원가입
- **엔드포인트**: `POST /api/v1/auth/signup`
- **인증**: 불필요
- **요청 형식**: `multipart/form-data` (프로필 이미지 포함 시) 또는 `application/json`
- **요청 파라미터**:
  - `email`: String (필수, 이메일)
  - `password`: String (필수, 비밀번호)
  - `nickname`: String (필수, 닉네임)
  - `agreeTerms`: Boolean (필수, 이용약관 동의)
  - `agreePrivacy`: Boolean (필수, 개인정보처리방침 동의)
  - `profileImage`: File (선택, 프로필 이미지)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "token": "JWT_TOKEN",
      "user": {
        "id": "string",
        "email": "string",
        "username": "string",
        "nickname": "string",
        "avatarUrl": "string",
        ...
      }
    }
  }
  ```
- **비즈니스 로직**:
  - 이메일 중복 체크
  - 비밀번호 암호화 (BCrypt)
  - 이용약관 및 개인정보처리방침 동의 필수
  - 초기 프로필 생성
  - 프로필 이미지 업로드 (선택)

### 1.2 로그인
- **엔드포인트**: `POST /api/v1/auth/login`
- **인증**: 불필요
- **요청 파라미터**:
  - `email`: String
  - `password`: String
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "token": "JWT_TOKEN",
      "user": UserDto
    }
  }
  ```
- **비즈니스 로직**:
  - 이메일/비밀번호 검증
  - JWT 토큰 발급
  - 로그인 이력 기록

### 1.3 비밀번호 찾기
- **엔드포인트**: `POST /api/v1/auth/forgot-password`
- **인증**: 불필요
- **요청 파라미터**:
  - `email`: String
- **응답**: 
  ```json
  {
    "success": true,
    "message": "비밀번호 재설정 링크가 이메일로 발송되었습니다."
  }
  ```
- **비즈니스 로직**:
  - 이메일 존재 여부 확인
  - 비밀번호 재설정 링크 이메일 발송
  - 재설정 토큰 생성 (유효기간 1시간)

### 1.4 비밀번호 재설정
- **엔드포인트**: `POST /api/v1/auth/reset-password`
- **인증**: 불필요
- **요청 파라미터**:
  - `token`: String (재설정 토큰)
  - `newPassword`: String
- **응답**: 
  ```json
  {
    "success": true,
    "message": "비밀번호가 성공적으로 변경되었습니다."
  }
  ```
- **비즈니스 로직**:
  - 토큰 유효성 검증
  - 비밀번호 업데이트

### 1.5 비밀번호 변경
- **엔드포인트**: `PUT /api/v1/auth/change-password`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `currentPassword`: String
  - `newPassword`: String
- **응답**: 
  ```json
  {
    "success": true,
    "message": "비밀번호가 성공적으로 변경되었습니다."
  }
  ```
- **비즈니스 로직**:
  - 현재 비밀번호 검증
  - 새 비밀번호로 업데이트

### 1.6 로그아웃
- **엔드포인트**: `POST /api/v1/auth/logout`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "message": "로그아웃되었습니다."
  }
  ```
- **비즈니스 로직**:
  - 토큰 무효화 (블랙리스트 추가)
  - 클라이언트에서 토큰 삭제

---

## 2. 사용자 (User)

### 2.1 프로필 조회
- **엔드포인트**: `GET /api/v1/users/{userId}`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "id": "string",
      "email": "string",
      "username": "string",
      "nickname": "string",
      "avatarUrl": "string",
      "statusMessage": "string",
      "joinedAt": "2025-01-01T00:00:00Z",
      "friendCount": 0,
      "sentLetters": 0
    }
  }
  ```

### 2.2 프로필 수정
- **엔드포인트**: `PUT /api/v1/users/{userId}`
- **인증**: Required (JWT)
- **요청 형식**: `multipart/form-data` (이미지 포함 시) 또는 `application/json`
- **요청 파라미터**:
  - `nickname`: String (선택)
  - `statusMessage`: String (선택)
  - `avatarUrl`: String (선택) 또는 `profileImage`: File (선택)
- **응답**: UserDto

---

## 3. 편지 (Letter)

### 3.1 편지 작성
- **엔드포인트**: `POST /api/v1/letters`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `title`: String (필수)
  - `content`: String (필수)
  - `preview`: String (필수, 미리보기 텍스트)
  - `flowerType`: String (필수, ROSE, TULIP, SAKURA, SUNFLOWER, DAISY, LAVENDER)
  - `visibility`: String (필수, PUBLIC, FRIENDS, DIRECT, PRIVATE)
  - `isAnonymous`: Boolean (기본값: false)
  - `template`: Object (선택)
    - `background`: String (색상 코드)
    - `textColor`: String (색상 코드)
    - `fontFamily`: String
    - `fontSize`: Number
  - `fontFamily`: String (선택, 최상위 레벨)
  - `attachedImages`: Array<String> (이미지 URL 리스트)
  - `scheduledAt`: String (선택, ISO 8601 형식, 예약 발송)
  - `recipientId`: String (선택, DIRECT인 경우 필수)
- **응답**: 
  ```json
  {
    "success": true,
    "data": LetterDto
  }
  ```
- **비즈니스 로직**:
  - 편지 생성
  - 이미지 업로드 처리 (S3 등)
  - 예약 발송인 경우 스케줄러에 등록
  - DIRECT인 경우 수신자에게 알림 발송
  - PUBLIC인 경우 하늘에 씨앗으로 표시

### 3.2 편지 목록 조회 (하늘 - 공개 편지)
- **엔드포인트**: `GET /api/v1/letters/public`
- **인증**: Required (JWT)
- **쿼리 파라미터**:
  - `page`: Integer (기본값: 0)
  - `size`: Integer (기본값: 20)
- **응답**: Page<LetterDto>
- **비즈니스 로직**:
  - PUBLIC인 편지만 조회
  - 조회수 증가
  - 랜덤 위치 계산 (화면 좌표)

### 3.3 편지 상세 조회
- **엔드포인트**: `GET /api/v1/letters/{letterId}`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "id": "string",
      "title": "string",
      "content": "string",
      "preview": "string",
      "sender": UserDto,
      "flowerType": "ROSE",
      "sentAt": "2025-01-01T00:00:00Z",
      "isAnonymous": false,
      "views": 0,
      "visibility": "PUBLIC",
      "attachedImages": [],
      "template": {
        "background": "#FFFFFF",
        "textColor": "#000000",
        "fontFamily": "Poppins",
        "fontSize": 16
      }
    }
  }
  ```
- **비즈니스 로직**:
  - 권한 체크 (PRIVATE인 경우 본인만, DIRECT인 경우 수신자/발신자만)
  - 조회수 증가

### 3.4 편지 답장
- **엔드포인트**: `POST /api/v1/letters/{letterId}/reply`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `title`: String (필수)
  - `content`: String (필수)
  - `preview`: String (필수)
  - `flowerType`: String (필수)
  - `isAnonymous`: Boolean (기본값: false)
  - `template`: Object (선택)
  - `attachedImages`: Array<String> (선택)
- **응답**: LetterDto
- **비즈니스 로직**:
  - 답장은 자동으로 DIRECT visibility로 설정됨
  - 원본 편지의 발신자에게 자동 전송
  - 친구 관계가 없으면 자동으로 친구 추가

### 3.5 편지 신고
- **엔드포인트**: `POST /api/v1/letters/{letterId}/report`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `reason`: String
- **응답**: 
  ```json
  {
    "success": true,
    "message": "신고가 접수되었습니다."
  }
  ```
- **비즈니스 로직**:
  - 신고 내용 저장
  - 관리자 알림

### 3.6 편지 삭제
- **엔드포인트**: `DELETE /api/v1/letters/{letterId}`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "message": "편지가 삭제되었습니다."
  }
  ```
- **비즈니스 로직**:
  - 본인 편지만 삭제 가능
  - 첨부 이미지 삭제
  - 관련 알림 삭제

---

## 4. 꽃다발 (Bouquet)

### 4.1 친구 목록 조회
- **엔드포인트**: `GET /api/v1/bouquets`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "data": [
      {
        "friend": {
          "id": "string",
          "user": UserDto,
          "lastLetterAt": "2025-01-01T00:00:00Z",
          "friendCount": 0,
          "sentLetters": 0
        },
        "bloomLevel": 0.5,
        "trustScore": 50,
        "bouquetName": "string",
        "unreadCount": 1
      }
    ]
  }
  ```
- **비즈니스 로직**:
  - 친구 관계 조회
  - 각 친구와의 편지 교환 내역 조회
  - 꽃다발 상태 계산 (bloomLevel, trustScore)

### 4.2 친구별 편지 목록 조회
- **엔드포인트**: `GET /api/v1/bouquets/{friendId}/letters`
- **인증**: Required (JWT)
- **쿼리 파라미터**:
  - `page`: Integer (기본값: 0)
  - `size`: Integer (기본값: 20)
  - `sort`: String (기본값: "sentAt,desc")
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "content": [
        {
          "id": "string",
          "letter": {
            "id": "string",
            "title": "string",
            "preview": "string",
            "fontFamily": "string"
          },
          "flowerType": "ROSE",
          "sentAt": "2025-01-01T00:00:00Z",
          "sentByMe": true,
          "isRead": true,
          "fontFamily": "string"
        }
      ],
      "page": 0,
      "size": 20,
      "totalElements": 10,
      "totalPages": 1,
      "first": true,
      "last": true
    }
  }
  ```
- **비즈니스 로직**:
  - 친구와 주고받은 편지만 조회
  - 시간순 정렬 (기본값: 최신순)
  - 읽음 상태 포함

### 4.3 꽃다발 이름 변경
- **엔드포인트**: `PUT /api/v1/bouquets/{friendId}/name`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `bouquetName`: String
- **응답**: BouquetDto

---

## 5. 친구 (Friend)

### 5.1 친구 추가 (초대 코드로)
- **엔드포인트**: `POST /api/v1/friends/invite`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `inviteCode`: String
- **응답**: FriendProfileDto
- **비즈니스 로직**:
  - 초대 코드 유효성 검증
  - 친구 관계 생성 (양방향)
  - 초대 코드 사용 처리

### 5.2 친구 목록 조회
- **엔드포인트**: `GET /api/v1/friends`
- **인증**: Required (JWT)
- **응답**: List<FriendProfileDto>
- **비즈니스 로직**:
  - 친구 관계 조회
  - 친구 프로필 정보 포함

### 5.3 친구 삭제
- **엔드포인트**: `DELETE /api/v1/friends/{friendId}`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "message": "친구가 삭제되었습니다."
  }
  ```
- **비즈니스 로직**:
  - 친구 관계 삭제 (양방향)
  - 관련 꽃다발 데이터 유지 (히스토리 보존)

---

## 6. 초대 코드 (Invite Code)

### 6.1 초대 코드 생성
- **엔드포인트**: `POST /api/v1/invite-codes/generate`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "code": "USERNAME-123456",
      "expiresAt": "2025-01-01T00:03:00Z",
      "remainingMinutes": 3
    }
  }
  ```
- **비즈니스 로직**:
  - 초대 코드 생성 (형식: {USERNAME}-{6자리숫자})
  - 유효기간 3분 설정
  - 기존 코드가 있으면 갱신

### 6.2 초대 코드 조회
- **엔드포인트**: `GET /api/v1/invite-codes/current`
- **인증**: Required (JWT)
- **응답**: InviteCodeDto 또는 null (만료된 경우)
- **비즈니스 로직**:
  - 현재 유효한 초대 코드 조회
  - 만료된 경우 null 반환

---

## 7. 알림 (Notification)

### 7.1 알림 목록 조회
- **엔드포인트**: `GET /api/v1/notifications`
- **인증**: Required (JWT)
- **쿼리 파라미터**:
  - `page`: Integer (기본값: 0)
  - `size`: Integer (기본값: 20)
  - `category`: String (선택, LETTER, REACTION, FRIEND, SYSTEM)
- **응답**: Page<NotificationDto>
  ```json
  {
    "success": true,
    "data": {
      "content": [
        {
          "id": "string",
          "title": "string",
          "subtitle": "string",
          "time": "2025-01-01T00:00:00Z",
          "category": "LETTER",
          "isUnread": true,
          "relatedId": "string"
        }
      ],
      ...
    }
  }
  ```

### 7.2 알림 읽음 처리
- **엔드포인트**: `PUT /api/v1/notifications/{notificationId}/read`
- **인증**: Required (JWT)
- **응답**: NotificationDto

### 7.3 알림 전체 읽음 처리
- **엔드포인트**: `PUT /api/v1/notifications/read-all`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "message": "모든 알림이 읽음 처리되었습니다.",
    "data": {
      "readCount": 10
    }
  }
  ```

### 7.4 알림 삭제
- **엔드포인트**: `DELETE /api/v1/notifications/{notificationId}`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "message": "알림이 삭제되었습니다."
  }
  ```

---

## 8. 설정 (Settings)

### 8.1 푸시 알림 설정 조회
- **엔드포인트**: `GET /api/v1/settings/push-notification`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "enabled": true
    }
  }
  ```

### 8.2 푸시 알림 설정 변경
- **엔드포인트**: `PUT /api/v1/settings/push-notification`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `enabled`: Boolean
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "enabled": true
    }
  }
  ```

### 8.3 언어 설정 조회
- **엔드포인트**: `GET /api/v1/settings/language`
- **인증**: Required (JWT)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "language": "ko"
    }
  }
  ```

### 8.4 언어 설정 변경
- **엔드포인트**: `PUT /api/v1/settings/language`
- **인증**: Required (JWT)
- **요청 파라미터**:
  - `language`: String (ko, en, ja)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "language": "ko"
    }
  }
  ```

---

## 9. 파일 업로드

### 9.1 이미지 업로드
- **엔드포인트**: `POST /api/v1/files/upload`
- **인증**: Required (JWT)
- **요청 형식**: `multipart/form-data`
- **요청 파라미터**:
  - `file`: File (이미지 파일)
- **응답**: 
  ```json
  {
    "success": true,
    "data": {
      "url": "https://...",
      "fileName": "image.jpg"
    }
  }
  ```
- **비즈니스 로직**:
  - 이미지 파일 검증 (크기, 형식)
  - S3 또는 로컬 스토리지에 업로드
  - URL 반환

---

## 공통 사항

### 날짜/시간
- ISO 8601 형식 사용
- 타임존: UTC
- 클라이언트에서 로컬 타임존으로 변환

### Health Check
- **엔드포인트**: `GET /api/v1/actuator/health`
- **인증**: 불필요
- **용도**: 배포 환경에서 서버 상태 확인

---

# 화면별 기능명세서

## 1. 스플래시 화면 (SplashScreen)

### 1.1 화면 개요
- 앱 최초 실행 시 표시되는 로딩 화면
- 앱 아이콘과 브랜드명 표시
- 인증 상태 확인 및 다음 화면 결정

### 1.2 주요 기능
- **자동 인증 확인**: 저장된 토큰으로 인증 상태 확인
- **화면 전환**: 
  - 인증됨 → 메인 화면 (MainShell)
  - 미인증 → 로그인 화면 (LoginScreen)
- **로딩 시간**: 약 1.8초 후 자동 전환

### 1.3 UI 구성
- 그라데이션 배경 (보라색 계열)
- 중앙에 앱 아이콘 (SVG)
- 앱 이름 "Taba" 텍스트

---

## 2. 로그인 화면 (LoginScreen)

### 2.1 화면 개요
- 사용자 로그인을 위한 인증 화면
- 회원가입 및 비밀번호 찾기로 이동 가능

### 2.2 주요 기능
- **이메일/비밀번호 로그인**
  - 이메일 형식 검증
  - 비밀번호 입력 (마스킹)
  - 로그인 버튼 활성화/비활성화
- **회원가입 이동**: 하단 링크 클릭 시 회원가입 화면으로 이동
- **비밀번호 찾기**: 링크 클릭 시 비밀번호 찾기 화면으로 이동
- **자동 로그인**: 로그인 성공 시 토큰 저장 및 메인 화면 이동
- **토큰 출력**: 로그인 성공 시 터미널에 Bearer 토큰 출력 (Swagger 테스트용)

### 2.3 UI 구성
- 그라데이션 배경 (dusk 테마)
- 반투명 카드 컨테이너
- 이메일/비밀번호 입력 필드
- 로그인 버튼
- 회원가입/비밀번호 찾기 링크

### 2.4 에러 처리
- 로그인 실패 시 스낵바로 에러 메시지 표시
- 401 에러: "이메일 또는 비밀번호가 올바르지 않습니다"

---

## 3. 회원가입 화면 (SignupScreen)

### 3.1 화면 개요
- 신규 사용자 회원가입 화면
- 프로필 이미지 설정 포함

### 3.2 주요 기능
- **프로필 이미지 설정** (선택사항)
  - 갤러리에서 선택
  - 카메라로 촬영
  - 이미지 제거
  - 이미지 업로드 및 URL 저장
- **회원가입 정보 입력**
  - 이메일 (필수)
  - 닉네임 (필수)
  - 비밀번호 (필수, 8자 이상)
  - 비밀번호 확인 (필수)
- **약관 동의**
  - 서비스 이용약관 동의 (필수)
  - 개인정보 처리방침 동의 (필수)
  - 약관 보기 모달
- **회원가입 처리**
  - 입력값 검증
  - 프로필 이미지 업로드 (선택)
  - 회원가입 API 호출
  - 성공 시 로그인 화면으로 복귀
- **토큰 출력**: 회원가입 성공 시 터미널에 Bearer 토큰 출력

### 3.3 UI 구성
- 그라데이션 배경
- 프로필 이미지 선택 영역 (원형 아바타)
- 입력 폼 카드
- 약관 동의 체크박스
- 가입하기 버튼

### 3.4 검증 규칙
- 이메일 형식 검증
- 비밀번호 일치 확인
- 모든 필수 필드 입력 확인
- 약관 동의 필수

---

## 4. 비밀번호 찾기 화면 (ForgotPasswordScreen)

### 4.1 화면 개요
- 비밀번호 재설정을 위한 이메일 입력 화면

### 4.2 주요 기능
- **이메일 입력**: 가입한 이메일 주소 입력
- **재설정 링크 발송**: 이메일로 비밀번호 재설정 링크 전송
- **성공 메시지**: 링크 발송 성공 시 안내 메시지 표시

### 4.3 UI 구성
- 그라데이션 배경
- 안내 텍스트
- 이메일 입력 필드
- 재설정 링크 보내기 버튼

---

## 5. 튜토리얼 화면 (TutorialScreen)

### 5.1 화면 개요
- 앱 사용법을 안내하는 온보딩 화면
- 최초 로그인 시에만 표시

### 5.2 주요 기능
- **페이지뷰**: 4개의 튜토리얼 페이지
  - Welcome to Taba: 앱 소개
  - Catch seeds: 씨앗 잡기 안내
  - Bloom flowers: 꽃 피우기 안내
  - Your bouquet: 꽃다발 만들기 안내
- **페이지 네비게이션**
  - 다음 버튼으로 다음 페이지 이동
  - 마지막 페이지에서 "시작하기" 버튼
  - 건너뛰기 버튼 (우측 상단)
- **페이지 인디케이터**: 현재 페이지 표시

### 5.3 UI 구성
- 그라데이션 배경 (galaxy 테마)
- 각 페이지별 이모지 및 설명
- 페이지 인디케이터
- 다음/시작하기 버튼

---

## 6. 메인 셸 (MainShell)

### 6.1 화면 개요
- 앱의 메인 컨테이너
- 하늘 화면을 표시하고 플로팅 액션 버튼 제공

### 6.2 주요 기능
- **데이터 로딩**
  - 공개 편지 목록 조회
  - 알림 목록 조회
  - 꽃다발 미읽음 개수 조회
- **화면 이동**
  - 꽃다발 화면 열기
  - 설정 화면 열기
  - 편지 작성 화면 열기
- **데이터 새로고침**: 프로필 수정 후 자동 새로고침

### 6.3 UI 구성
- SkyScreen (하늘 화면)
- 플로팅 액션 버튼 (편지 쓰기)

---

## 7. 하늘 화면 (SkyScreen)

### 7.1 화면 개요
- 공개 편지를 씨앗 형태로 표시하는 메인 화면
- 시간대별 그라데이션 배경 변경

### 7.2 주요 기능
- **시간대별 배경**
  - 오전 (6-12시): Sky 그라데이션
  - 오후 (12-18시): Hero Blue 그라데이션
  - 저녁 (18시 이후): Dusk 그라데이션
- **씨앗 표시**
  - 공개 편지를 씨앗 아이콘으로 표시
  - 랜덤 위치 배치
  - 애니메이션 효과 (떠다니는 효과)
- **씨앗 클릭**
  - 씨앗 탭 시 편지 상세 화면으로 이동
  - 페이드 전환 애니메이션
- **헤더 버튼**
  - 꽃다발 아이콘 (미읽음 배지 표시)
  - 설정 아이콘
- **새로고침**: Pull-to-refresh 지원
- **빈 상태**: 편지가 없을 때 안내 메시지 표시

### 7.3 UI 구성
- 그라데이션 배경
- 헤더 (앱 이름, 아이콘 버튼)
- 씨앗 필드 (랜덤 배치)
- 새로고침 제스처

---

## 8. 꽃다발 화면 (BouquetScreen)

### 8.1 화면 개요
- 친구별 꽃다발을 관리하는 화면
- 친구와 주고받은 편지를 채팅 형태로 표시

### 8.2 주요 기능
- **친구 목록 표시**
  - 좌측에 친구 아바타 목록
  - 미읽음 편지 개수 배지 표시
  - 선택된 친구 하이라이트
- **편지 목록 (채팅 형태)**
  - 선택한 친구와의 편지 교환 내역
  - 내가 보낸 편지 / 받은 편지 구분
  - 시간 표시 (N분 전, N시간 전, N일 전)
  - 미읽음 편지 강조 표시
- **편지 열기**
  - 편지 버블 탭 시 편지 상세 화면으로 이동
  - 읽음 처리
- **편지 로딩**
  - 친구 선택 시 해당 친구의 편지 목록 로드
  - 페이징 지원
  - 로딩 상태 표시
  - 서버 에러 시 빈 목록 표시 (크래시 방지)

### 8.3 UI 구성
- 좌측: 친구 아바타 리스트 (수직 스크롤)
- 우측: 편지 채팅 영역 (SliverList)
- 편지 버블: 제목, 미리보기, 이모지, 시간

### 8.4 상태 관리
- 선택된 친구 인덱스
- 읽은 편지 ID 세트
- 친구별 편지 목록 캐시
- 로딩 상태 관리

---

## 9. 편지 상세 화면 (LetterDetailScreen)

### 9.1 화면 개요
- 편지의 전체 내용을 표시하는 화면
- 하늘 화면과 꽃다발 화면에서 모두 사용

### 9.2 주요 기능
- **편지 내용 표시**
  - 발신자 정보 (아바타, 닉네임)
  - 편지 제목
  - 편지 본문 (템플릿 적용)
  - 발송 시간
  - 꽃 타입 (이모지)
- **익명 처리**
  - 익명 편지인 경우 "익명의 사용자" 표시
  - 친구 이름이 있으면 친구 이름 표시
- **신고 기능**
  - 우측 상단 메뉴에서 신고 가능
  - 신고 사유 입력 다이얼로그
- **답장 기능** (친구에게 보낸 편지인 경우)
  - 답장 버튼 클릭 시 편지 작성 화면으로 이동
  - 초기 수신자 설정

### 9.3 UI 구성
- 헤더: 발신자 정보, 신고 버튼
- 편지 내용 영역
- 답장 버튼 (조건부 표시)

---

## 10. 편지 작성 화면 (WriteLetterPage)

### 10.1 화면 개요
- 새 편지를 작성하는 화면
- 다양한 템플릿과 폰트 지원

### 10.2 주요 기능
- **편지 작성**
  - 제목 입력
  - 본문 입력 (노트 스타일 에디터)
  - 미리보기 텍스트 자동 생성
- **템플릿 선택**
  - 6가지 템플릿 제공
  - 템플릿별 색상 및 스타일
- **폰트 선택**
  - 템플릿별 추천 폰트
  - Google Fonts 지원
- **꽃 타입 선택**
  - 장미, 튤립, 벚꽃, 해바라기, 데이지, 라벤더
  - 이모지로 표시
- **공개 범위 설정**
  - 공개: 모든 사용자에게 공개
  - 친구: 친구에게만 공개
  - 직접 전송: 특정 친구에게만 전송
  - 비공개: 본인만 볼 수 있음
- **익명 설정**: 익명으로 발송 여부
- **친구 선택** (직접 전송인 경우)
  - 친구 목록에서 선택
  - 검색 기능
- **이미지 첨부**
  - 갤러리에서 다중 선택
  - 이미지 미리보기
  - 이미지 제거
  - 이미지 업로드
- **편지 발송**
  - 입력값 검증
  - 이미지 업로드
  - 편지 생성 API 호출
  - 성공 시 이전 화면으로 복귀

### 10.3 UI 구성
- 상단: 템플릿 선택, 폰트 선택
- 중앙: 편지 작성 영역 (노트 스타일)
- 하단: 설정 패널 (꽃 타입, 공개 범위, 익명, 친구 선택, 이미지 첨부)
- 발송 버튼

---

## 11. 설정 화면 (SettingsScreen)

### 11.1 화면 개요
- 앱 설정 및 계정 관리 화면

### 11.2 주요 기능
- **프로필 카드**
  - 사용자 아바타, 닉네임, 사용자명, 상태 메시지 표시
  - 탭 시 프로필 수정 화면으로 이동
- **푸시 알림 설정**
  - 알림 ON/OFF 토글
  - 설정 저장
- **친구 초대**
  - 현재 초대 코드 표시
  - 유효 시간 표시 (3분)
  - 코드 복사
  - 코드 공유
  - 코드 재발급
- **친구 추가**
  - 친구 코드로 친구 추가
  - 코드 입력 다이얼로그
- **계정 관리**
  - 비밀번호 변경 (준비 중)
  - 개인정보 설정 (준비 중)
- **언어 설정**
  - 한국어, 영어, 일본어 선택
  - 드롭다운 메뉴
- **로그아웃**
  - 로그아웃 확인 다이얼로그
  - 로그아웃 처리

### 11.3 UI 구성
- 프로필 카드 (상단)
- 알림 섹션
- 친구 초대 섹션
- 친구 추가 섹션
- 계정 섹션
- 언어 섹션
- 로그아웃 버튼

---

## 12. 프로필 수정 화면 (EditProfileScreen)

### 12.1 화면 개요
- 사용자 프로필 정보를 수정하는 화면
- 설정 화면에서 프로필 카드 탭 시 이동

### 12.2 주요 기능
- **프로필 이미지 수정**
  - 현재 프로필 이미지 표시
  - 갤러리에서 선택
  - 카메라로 촬영
  - 이미지 제거
  - 이미지 업로드
- **닉네임 수정**
  - 현재 닉네임 표시
  - 텍스트 입력
- **상태 메시지 수정**
  - 현재 상태 메시지 표시
  - 멀티라인 텍스트 입력
- **프로필 저장**
  - 입력값 검증
  - 새 이미지 업로드 (선택)
  - 프로필 업데이트 API 호출
  - 성공 시 설정 화면으로 복귀
  - 성공 메시지 표시

### 12.3 UI 구성
- 상단: 프로필 이미지 (원형, 카메라 아이콘 오버레이)
- 중앙: 닉네임 입력 필드
- 하단: 상태 메시지 입력 필드
- 우측 상단: 저장 버튼

### 12.4 검증 규칙
- 닉네임 필수 입력
- 이미지 업로드 실패 시 에러 메시지

---

## 13. 이용약관 화면 (TermsScreen)

### 13.1 화면 개요
- 서비스 이용약관 및 개인정보 처리방침을 표시하는 화면

### 13.2 주요 기능
- **약관 표시**
  - 이용약관 내용
  - 개인정보 처리방침 내용
- **동의 처리**
  - 동의 버튼 클릭 시 동의 처리
  - 모달로 표시되며 동의 시 닫힘

### 13.3 UI 구성
- 스크롤 가능한 텍스트 영역
- 동의 버튼

---

## 공통 컴포넌트

### UserAvatar 위젯
- **기능**: 사용자 프로필 이미지를 표시하는 공통 위젯
- **기본 프로필 이미지**: avatarUrl이 비어있을 경우 이니셜과 배경색으로 표시
- **사용 위치**: 모든 사용자 정보 표시 화면

### TabaNotice 위젯
- **기능**: 앱 내 알림 메시지를 표시하는 위젯
- **사용 위치**: 성공/안내 메시지 표시 시

---

## 화면 전환 흐름

### 인증 플로우
1. SplashScreen → 인증 확인
2. 미인증 → LoginScreen
3. LoginScreen → 로그인 성공 → TutorialScreen (최초) / MainShell
4. LoginScreen → SignupScreen
5. LoginScreen → ForgotPasswordScreen

### 메인 플로우
1. MainShell (SkyScreen) → 편지 상세 / 꽃다발 / 설정 / 편지 작성
2. BouquetScreen → 편지 상세
3. LetterDetailScreen → 편지 작성 (답장)
4. SettingsScreen → EditProfileScreen

### 데이터 흐름
- 모든 화면은 DataRepository를 통해 API 호출
- 프로필 수정 후 MainShell에서 자동 새로고침
- 편지 작성 후 MainShell에서 자동 새로고침

---

## 클라이언트 구현 세부사항

### API 클라이언트 (ApiClient)
- **기능**: Dio 기반 HTTP 클라이언트
- **인터셉터**:
  - 요청 시 자동으로 Bearer 토큰 추가
  - Health check 엔드포인트는 인증 제외
  - 첫 번째 API 요청 시 토큰 출력 (Swagger 테스트용)
  - 401 에러 시 자동 토큰 삭제
- **에러 처리**: 상세한 에러 로깅 및 파싱

### 데이터 레이어 구조
- **Service**: API 호출 담당
- **Repository**: 비즈니스 로직 및 데이터 변환
- **DTO**: API 응답 파싱
- **Model**: 앱 내부 데이터 모델

### 에러 처리 전략
- 서버 에러(500) 시 빈 리스트 반환하여 앱 크래시 방지
- 상세한 에러 로깅으로 디버깅 용이
- 사용자 친화적인 에러 메시지 표시
